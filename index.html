<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dungeon of Doors | Start</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <img src="assets/img/wizard.png" alt="Wizard" />
        <div>
          <h1>Dungeon of Doors</h1>
          <p>Answer the wizards. Choose the right door. Survive.</p>
        </div> 

    <div class="card">
        <video class="bgVideo" autoplay muted loop playsinline>
        <source src="assets/video/cave.webm" type="video/mp4">
        </video>


      <div class="content">
        <p class="kicker">
          You step into a cold cave dungeon. Four enchanted doors wait ahead.
          A wizard’s voice echoes: “Only knowledge opens the safe path.”
        </p>

        <hr />

        <div class="footer">
          <button class="btn" id="startAudioBtn" type="button">Start ambience</button>
          <span class="audioHint">If you hear a low dungeon hum, it worked.</span>
        </div>

        <div class="choices">
          <a class="btn" href="q1.html">Enter the first hall</a>
          <a class="btn" href="lose_pit.html">Run forward blindly</a>
          <a class="btn" href="lose_spikes.html">Touch the glowing runes</a>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  let audioStarted = false;
  function startDungeonAmbience() {
    if (audioStarted) return;
    audioStarted = true;

    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioCtx();

    // Master
    const master = ctx.createGain();
    master.gain.value = 0.22;
    master.connect(ctx.destination);

    // Slight reverb-ish feel using delay (simple, lightweight)
    const delay = ctx.createDelay(0.6);
    delay.delayTime.value = 0.18;
    const fb = ctx.createGain();
    fb.gain.value = 0.35;
    delay.connect(fb);
    fb.connect(delay);
    delay.connect(master);

    // Noise (windy cave)
    const bufferSize = ctx.sampleRate * 2;
    const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = noiseBuffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1) * 0.35;

    const noise = ctx.createBufferSource();
    noise.buffer = noiseBuffer;
    noise.loop = true;

    const noiseFilter = ctx.createBiquadFilter();
    noiseFilter.type = "lowpass";
    noiseFilter.frequency.value = 420;

    const noiseGain = ctx.createGain();
    noiseGain.gain.value = 0.18;

    noise.connect(noiseFilter);
    noiseFilter.connect(noiseGain);
    noiseGain.connect(master);
    noiseGain.connect(delay);

    // Low drone
    const osc = ctx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = 55;

    const osc2 = ctx.createOscillator();
    osc2.type = "triangle";
    osc2.frequency.value = 110;

    const droneFilter = ctx.createBiquadFilter();
    droneFilter.type = "lowpass";
    droneFilter.frequency.value = 260;

    const droneGain = ctx.createGain();
    droneGain.gain.value = 0.16;

    osc.connect(droneFilter);
    osc2.connect(droneFilter);
    droneFilter.connect(droneGain);
    droneGain.connect(master);
    droneGain.connect(delay);

    // Slow tremble (LFO)
    const lfo = ctx.createOscillator();
    lfo.type = "sine";
    lfo.frequency.value = 0.12;

    const lfoGain = ctx.createGain();
    lfoGain.gain.value = 0.05;
    lfo.connect(lfoGain);
    lfoGain.connect(droneGain.gain);

    noise.start();
    osc.start();
    osc2.start();
    lfo.start();
  }

  document.getElementById("startAudioBtn").addEventListener("click", startDungeonAmbience);
})();
</script>
</body>
<audio autoplay loop>
  <source src="assets/sound/background_music.wav" type = "audio/wav">
</audio>
</html>